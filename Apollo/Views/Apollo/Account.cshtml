@model Apollo.Models.Apollo.User
@{
    ViewBag.Title = "Account";
}

<h4 id="username">@Model.Username</h4>
<h4 id="email">@Model.Email</h4>

<h3>Change Email</h3>
<div class="form-group">
    <input id="emailInput" type="email" name="new-email" class="form-control" placeholder="new email" style="float: left"/>
    <input id="emailSubmit" type="submit" class="btn btn-info"/> 
</div>

<h3>Change Password</h3>
<div class="form-group">
    <input id="oldPassInput" type="password" name="old-pass" class="form-control" placeholder="old password" style="float: left"/>
    <input id="newPassInput" type="password" name="new-pass" class="form-control" placeholder="new password" style="float: left"/>
    <input id="passwordSubmit" type="submit" class="btn btn-info" />
</div>

@Html.ActionLink("Logout", "Logout", "Apollo", new { area = "" }, new { @class = "btn btn-danger" })

<div id="status" class="text-info">

</div>

@section scripts {
    <script>
        $(function () {
            $("#emailSubmit").on("click", function () {
                var email = $("#emailInput").val();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ChangeEmail", "Apollo")",
                    data: { newEmail: email },
                    dataType: 'text',
                    success: function (data) {
                        if (data == "True") {
                            $("#status").html("<p>Email changed succesfully.</p>");
                            $("#email").html(email);
                        } else {
                            $("#status").html("<p>Error changing email.</p>");
                        }
                    },
                    error: function (data) {
                        $("#status").html("<p>Error changing email.</p>");
                    }
                });
            });

            $("#passwordSubmit").on("click", function () {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ChangePassword", "Apollo")",
                    data: { oldPass: $("#oldPassInput").val(), newPass: $("#newPassInput").val() },
                    dataType: 'text',
                    success: function (data) {
                        if (data == "True") {
                            $("#status").html("<p>Password changed succesfully.</p>");
                        } else {
                            $("#status").html("<p>Error changing password.</p>");
                        }
                    },
                    error: function(data) {
                        $("#status").html("<p>Error changing password.</p>");
                    }
                });
            });
        });
    </script>
}
